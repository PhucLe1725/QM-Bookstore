name: Keep Render Service Alive

on:
  schedule:
    # Ch·∫°y m·ªói 10 ph√∫t ƒë·ªÉ tr√°nh Render sleep sau 15 ph√∫t
    - cron: '*/10 * * * *'
  workflow_dispatch: # Cho ph√©p trigger th·ªß c√¥ng t·ª´ GitHub UI

jobs:
  ping-backend:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    
    steps:
      - name: Ping QM Bookstore Backend
        run: |
          echo "üîî Pinging backend at $(date)"
          
          # G·ªçi endpoint /api/auth/test
          response=$(curl -s -o /dev/null -w "%{http_code}" \
            -X GET https://qm-bookstore-backend.onrender.com/api/auth/test \
            --max-time 30 \
            --retry 3 \
            --retry-delay 5 \
            --retry-max-time 60)
          
          echo "üìä Response code: $response"
          
          if [ "$response" -eq 200 ] || [ "$response" -eq 404 ]; then
            echo "‚úÖ Backend is alive (HTTP $response)"
            exit 0
          else
            echo "‚ö†Ô∏è Unexpected response: $response (but continuing...)"
            exit 0
          fi
      
      - name: Log Completion
        if: always()
        run: |
          echo "‚ú® Keep-alive job completed at $(date)"
          echo "‚è∞ Next run in ~10 minutes"
